function fix_colums(){var e=$(".ff-container").width()-2;$(".uploader").css("width",e-6);if($("#view").val()>=1){if($("#view").val()==1){var t=1}else{var t=Math.floor(e/380);if(t==0){t=1;$("h4").css("font-size",12)}}e=Math.floor(e/t-3);$("ul.grid li, ul.grid figure").css("width",e);$("#help").hide()}else{if(Modernizr.touch){$("#help").show()}}}function swipe_reaction(e,t,n,r,i){var s=$(this);if($("#view").val()==0){if(s.attr("toggle")==1){s.attr("toggle",0);s.animate({top:"0px"},{queue:false,duration:300})}else{s.attr("toggle",1);s.animate({top:"-30px"},{queue:false,duration:300})}}}function apply(e,t){if($("#popup").val()==1)var n=window.opener;else var n=window.parent;var r=$("#cur_dir").val();var i=$("#base_url").val();var s=e.substr(0,e.lastIndexOf("."));var o=e.split(".").pop();var u="";if($.inArray(o,ext_img)>-1){u='<img src="'+r+e+'" alt="'+s+'" />'}else{u='<a href="'+r+e+'" title="'+s+'">'+s+"</a>"}parent.tinymce.activeEditor.insertContent(u);parent.tinymce.activeEditor.windowManager.close()}function apply_link(e,t){if($("#popup").val()==1)var n=window.opener;else var n=window.parent;var r=$("#cur_dir").val();r=r.replace("\\","/");var i=$("#base_url").val();if(t!=""){var s=$("#"+t,n.document);$(s).val(i+r+e);close_window()}else apply_any(r,e)}function apply_img(e,t){if($("#popup").val()==1)var n=window.opener;else var n=window.parent;var r=$("#cur_dir").val();r=r.replace("\\","/");var i=$("#base_url").val();if(t!=""){var s=$("#"+t,n.document);$(s).val(i+r+e);close_window()}else apply_any(r,e)}function apply_video(e,t){if($("#popup").val()==1)var n=window.opener;else var n=window.parent;var r=$("#cur_dir").val();r=r.replace("\\","/");var i=$("#base_url").val();if(t!=""){var s=$("#"+t,n.document);$(s).val(i+r+e);close_window()}else apply_any(r,e)}function apply_none(e,t){return}function apply_any(e,t){e=e.replace("\\","/");parent.tinymce.activeEditor.windowManager.getParams().setUrl(e+t);parent.tinymce.activeEditor.windowManager.close();return false}function close_window(){parent.jQuery.fancybox.close();if(window.frameElement.parentNode.id)parent.$("#"+window.frameElement.parentNode.id).dialog("close");else if($("#popup").val()==1)window.close();else{if(typeof parent.$!=="undefined"&&parent.$){parent.$.fancybox.close();}else{parent.jQuery.fancybox.close();}}}function apply_file_rename(e,t){e.find("h4").find("a").text(t);var n=e.find("a.link");var r=n.data("file");var i=r.substring(r.lastIndexOf(".")+1);n.data("file",t+"."+i);var s=e.find("a.preview");var r=s.data("url");if(typeof r!=="undefined"&&r){var o=r.substring(r.lastIndexOf("/")+1);s.data("url",r.replace(o,t+"."+i))}var u=e.find("a.rename-file");var a=e.find("a.delete-file");var f=u.data("path");var l=u.data("thumb");var c=f.replace(o,t+"."+i);var h=l.replace(o,t+"."+i);u.data("path",c);u.data("thumb",h);a.data("path",c);a.data("thumb",h)}function apply_folder_rename(e,t){var n=e.find("h4").find("a").text();e.find("h4").find("a").text(t);var r=e.find(".folder-link");var i=r.attr("href");var s=$("#fldr_value").val();r.attr("href",i.replace("fldr="+s+n,"fldr="+s+t));var o=e.find("a.delete-folder");var u=e.find("a.rename-folder");var a=u.data("path");var f=u.data("thumb");var l=a.lastIndexOf("/");var c=a.substr(0,l+1)+t;o.data("path",c);u.data("path",c);var l=f.lastIndexOf("/");var c=f.substr(0,l+1)+t;o.data("thumb",c);u.data("thumb",c)}function replace_last(e,t,n){var r=new RegExp(t+"$");return e.replace(r,n)}function RemoveAccents(e){e=e.split("");var t=new Array;var n=e.length;var r="ÀÁÂÃÄÅàáâãäåÒÓÔÕÕÖØòóôõöøÈÉÊËèéêëðÇçÐÌÍÎÏìíîïÙÚÛÜùúûüÑñŠšŸÿýŽž";var i="AAAAAAaaaaaaOOOOOOOooooooEEEEeeeeeCcDIIIIiiiiUUUUuuuuNnSsYyyZz";for(var s=0;s<n;s++){if(r.indexOf(e[s])!=-1){t[s]=i.substr(r.indexOf(e[s]),1)}else t[s]=e[s]}t=t.join("");return t}function clean_filename(e){if(e!=null){strii=RemoveAccents(e);strii=strii.replace(/[^A-Za-z0-9\.\-\ \_]+/g,"");return $.trim(strii.toLowerCase())}return null}function execute_action(e,t,n,r,i,s){r=clean_filename(r);$.ajax({type:"POST",url:"execute.php?action="+e,data:{path:t,path_thumb:n,name:r.replace("/","")}}).done(function(e){if(e!=""){bootbox.alert(e);return false}else{if(s!=""){window[s](i,r)}}return true})}function sortUnorderedList(e,t,n){if(typeof e=="string")e=$(e);var r=e.find("li.dir");var i=e.find("li.file");var s=[];var o=[];var u=[];var a=[];$.each(r,function(e){var t=$(this);var r=t.find(n).val();if($.isNumeric(r)){r=parseFloat(r);while(typeof s[r]!=="undefined"&&s[r]){r=parseFloat(parseFloat(r)+parseFloat(.001))}}else{r=r+"a"+t.find("h4 a").data("file")}s[r]=t.html();o.push(r)});$.each(i,function(e){var t=$(this);var r=t.find(n).val();if($.isNumeric(r)){r=parseFloat(r);while(typeof u[r]!=="undefined"&&u[r]){r=parseFloat(parseFloat(r)+parseFloat(.001))}}else{r=r+"a"+t.find("h4 a").data("file")}u[r]=t.html();a.push(r)});if($.isNumeric(o[0])){o.sort(function(e,t){return parseFloat(e)-parseFloat(t)})}else{o.sort()}if($.isNumeric(a[0])){a.sort(function(e,t){return parseFloat(e)-parseFloat(t)})}else{a.sort()}if(t){o.reverse();a.reverse()}$.each(r,function(e){var t=$(this);t.html(s[o[e]])});$.each(i,function(e){var t=$(this);t.html(u[a[e]])})}function show_animation(){$("#loading_container").css("display","block");$("#loading").css("opacity",".7")}function hide_animation(){$("#loading_container").fadeOut()}var version="8.1.1";if(!/MSIE (\d+\.\d+);/.test(navigator.userAgent)){window.addEventListener("DOMContentLoaded",function(){$("body").queryLoader2({backgroundColor:"none",minimumTime:100,percentage:true})})}else{$(document).ready(function(){$("body").queryLoader2({backgroundColor:"none",minimumTime:100,percentage:true})})}$(document).ready(function(){$.contextMenu({selector:"figure:not(.back-directory), .list-view2 figure:not(.back-directory) ",autoHide:true,build:function(e){var t={callback:function(e,t){},items:{}};if(e.data("type")=="dir")t.items.name={name:e.find("h4 a").html(),icon:"label",disabled:true};else t.items.name={name:e.find("h4 a").html()+"."+e.find(".file-extension").html(),icon:"label",disabled:true};if(e.data("type")=="img"){t.items.dimension={name:e.find(".img-dimension").html(),icon:"dimension",disabled:true}}t.items.size={name:e.find(".file-size").html(),icon:"size",disabled:true};t.items.date={name:e.find(".file-date").html(),icon:"date",disabled:true};return t}});$(document).on("contextmenu",function(e){if(!$(e.target).is("figure"))return false});$(".modalAV").on("click",function(e){_this=$(this);e.preventDefault();$("#previewAV").removeData("modal");$("#previewAV").modal({backdrop:"static",keyboard:false});if(_this.hasClass("audio")){$(".body-preview").css("height","80px")}else{$(".body-preview").css("height","345px")}$.ajax({url:_this.data("url"),success:function(e){$(".body-preview").html(e)}})});$("input[name=radio-sort]").on("click",function(){var e=$(this).data("item");$(".filters label").removeClass("btn-inverse");$(".filters label").find("i").removeClass("icon-white");$("#filter-input").val("");$("#"+e).addClass("btn-inverse");$("#"+e).find("i").addClass("icon-white");if(e=="ff-item-type-all"){$(".grid li").show(300)}else{if($(this).is(":checked")){$(".grid li").not("."+e).hide(300);$(".grid li."+e).show(300)}}});var e=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}();if(parseInt($("#file_number").val())>parseInt($("#file_number_limit_js").val()))var t=false;else var t=true;$("#filter-input").on("keyup",function(){$(".filters label").removeClass("btn-inverse");$(".filters label").find("i").removeClass("icon-white");$("#ff-item-type-all").addClass("btn-inverse");$("#ff-item-type-all").find("i").addClass("icon-white");var n=clean_filename($(this).val());$(this).val(n);e(function(){if(t){$("ul.grid li").each(function(){var e=$(this);if(n!=""&&e.data("name").toString().toLowerCase().indexOf(n.toLowerCase())==-1){e.hide(100)}else{e.show(100)}})}},300)}).keypress(function(e){if(e.which==13){$("#filter").trigger("click")}});$("#filter").on("click",function(){var e=clean_filename($("#filter-input").val());window.location.href=$("#current_url").val()+"&filter="+e});$("#info").on("click",function(){bootbox.alert('<center><img src="img/logo.png" alt="responsive filemanager"/><br/><br/><p><strong>RESPONSIVE filemanager v.'+version+'</strong><br/><a href="http://www.responsivefilemanager.com">responsivefilemanager.com</a></p><br/><p>Copyright © <a href="http://www.tecrail.com" alt="tecrail">Tecrail</a> - Alberto Peripolli. All rights reserved.</p><br/><p>License<br/><small><a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</small></p></center>')});$("#uploader-btn").on("click",function(){var e=$("#root").val()+$("#cur_dir").val()+"/";e=e.substring(0,e.length-1);$("#iframe-container").html($("<iframe />",{name:"JUpload",id:"uploader_frame",src:"uploader/index.php?path="+e,frameborder:0,width:"100%",height:360}))});$("#full-img").on("click",function(){$("#previewLightbox").lightbox("hide")});$(".upload-btn").on("click",function(){$(".uploader").show(500)});var n=$("#descending").val()==="true";$(".sorter").on("click",function(){_this=$(this);n=!n;if(t){$.ajax({url:"ajax_calls.php?action=sort&sort_by="+_this.data("sort")+"&descending="+n}).done(function(e){});sortUnorderedList("ul.grid",n,"."+_this.data("sort"));$(" a.sorter").removeClass("descending").removeClass("ascending");if(n)$(".sort-"+_this.data("sort")).addClass("descending");else $(".sort-"+_this.data("sort")).addClass("ascending")}else{window.location.href=$("#current_url").val()+"&sort_by="+_this.data("sort")+"&descending="+n}});$(".close-uploader").on("click",function(){$(".uploader").hide(500);window.location.href=$("#refresh").attr("href")+"&"+(new Date).getTime()});$("ul.grid").on("click",".preview",function(){var e=$(this);$("#full-img").attr("src",e.data("url"));if(!e.hasClass("disabled"))show_animation();return true});$("ul.grid").on("click",".rename-file",function(){var e=$(this);var t=e.parent().parent().parent();var n=t.find("h4");var r=$.trim(n.text());bootbox.prompt($("#rename").val(),$("#cancel").val(),$("#ok").val(),function(n){n=clean_filename(n);if(n!==null&&n!=r){execute_action("rename_file",e.data("path"),e.data("thumb"),n,t,"apply_file_rename")}},r)});$("ul.grid").on("click",".rename-folder",function(){var e=$(this);var t=e.parent().parent().parent();var n=t.find("h4");var r=$.trim(n.text());bootbox.prompt($("#rename").val(),$("#cancel").val(),$("#ok").val(),function(n){n=clean_filename(n);if(n!==null&&n!=r){execute_action("rename_folder",e.data("path"),e.data("thumb"),n,t,"apply_folder_rename")}},r)});$("ul.grid").on("click",".delete-file",function(){var e=$(this);bootbox.confirm(e.data("confirm"),$("#cancel").val(),$("#ok").val(),function(t){if(t==true){execute_action("delete_file",e.data("path"),e.data("thumb"),"","","");e.parent().parent().parent().parent().remove()}})});$("ul.grid").on("click",".delete-folder",function(){var e=$(this);bootbox.confirm(e.data("confirm"),$("#cancel").val(),$("#ok").val(),function(t){if(t==true){execute_action("delete_folder",e.data("path"),e.data("thumb"),"","","");e.parent().parent().parent().remove()}})});$(".new-folder").on("click",function(){bootbox.prompt($("#insert_folder_name").val(),$("#cancel").val(),$("#ok").val(),function(e){if(e!==null){e=clean_filename(e);var t=$("#root").val()+$("#cur_dir").val()+e;var n=$("#cur_dir_thumb").val()+e;$.ajax({type:"POST",url:"execute.php?action=create_folder",data:{path:t,path_thumb:n}}).done(function(e){window.location.href=$("#refresh").attr("href")+"&"+(new Date).getTime()})}},$("#new_folder").val())});$(".view-controller button").on("click",function(){var e=$(this);$(".view-controller button").removeClass("btn-inverse");$(".view-controller i").removeClass("icon-white");e.addClass("btn-inverse");e.find("i").addClass("icon-white");$.ajax({url:"ajax_calls.php?action=view&type="+e.data("value")}).done(function(e){if(e!=""){bootbox.alert(e)}});if(typeof $("ul.grid")[0]!=="undefined"&&$("ul.grid")[0])$("ul.grid")[0].className=$("ul.grid")[0].className.replace(/\blist-view.*?\b/g,"");if(typeof $(".sorter-container")[0]!=="undefined"&&$(".sorter-container")[0])$(".sorter-container")[0].className=$(".sorter-container")[0].className.replace(/\blist-view.*?\b/g,"");var t=e.data("value");$("#view").val(t);$("ul.grid").addClass("list-view"+t);$(".sorter-container").addClass("list-view"+t);if(e.data("value")>=1){fix_colums()}else{$("ul.grid li").css("width",126);$("ul.grid figure").css("width",122)}});if(!Modernizr.touch){$(".tip").tooltip({placement:"bottom"});$(".tip-left").tooltip({placement:"left"});$(".tip-right").tooltip({placement:"right"});$("body").addClass("no-touch")}else{$("#help").show();$(".box:not(.no-effect)").swipe({swipeLeft:swipe_reaction,swipeRight:swipe_reaction,threshold:30})}if(!Modernizr.csstransitions||!Modernizr.csstransforms){$("figure").bind("mouseover",function(){if($("#view").val()==0){$(this).find(".box:not(.no-effect)").animate({top:"-30px"},{queue:false,duration:300})}});$("figure").mouseout(function(){if($("#view").val()==0){$(this).find(".box:not(.no-effect)").animate({top:"0px"},{queue:false,duration:300})}})}$(window).resize(function(){fix_colums()});fix_colums();$(".link").on("click",function(){var e=$(this);window[e.data("function")](e.data("file"),e.data("field_id"))})})